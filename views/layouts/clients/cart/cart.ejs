<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Giỏ hàng</title>
    <%- include('../partials/head') %>
  </head>
  <body>
    <%- include('../partials/header') %>

    <div class="container">
      <div class="cartt">
        <div class="cart-heading">
          <img
            style="margin-top: 25px; margin-right: 10px; width: 25px; height: 25px;" src="/images/carttt.png" alt="" />
          <h3 style="margin-top: 18px;">Giỏ hàng</h3>
        </div>
        <%if(!carti[0]){%>
          <div class="cart-table">
            <p style="margin-top: 18px; font-size: 18px; font-weight:500">Giỏ hàng của bạn đang trống!!</p>
          </div>

          <div class="container" style="display:flex; justify-content:center;">
            <div class="cart-table-img">
              <img src="/images/empty-cart.png" style="width: 280px;" alt="">
            </div>
          </div>

          <div class="container" style="display:flex; justify-content:center;">
            <div class="back-home" style="width: 300px;">
              <a href="/">
                  <button class="btn btn-outline-dark btn-back-home">TIẾP TỤC MUA HÀNG</button>
              </a>
            </div>
          </div>
        <%}else{%>
          <div class="cart-table">
              <table class="table table-bordered table-striped">
                <thead>
                  <tr>
                      <th style="display: none;"></th>
                      <th>Hình ảnh</th>
                      <th>Tên sản phẩm</th>
                      <th style="border-right:none;">Đơn giá</th>
                      <th>Số lượng</th>
                      <th>Thành tiền</th>
                      <th>Hành động</th>
                  </tr>
                </thead>
                <tbody>
                  <% for(let i=0; i < danhsach.length; i++) { %> <%
                    danhsach[i].items.forEach(function(pid) { %>
                  <tr>
                    <td style="display: none;"><%= pid.productID._id %></td>
                    <td style="width: 155px;">
                      <img
                        style="width: 60px; height: 80px;"
                        src="/images/<%= pid.productID.productImage %>"
                        alt=""
                      />
                    </td>
                    <td style="width: 320px;">
                      <a href="/product/<%= pid.productID._id %>" style="text-decoration: none; color: #000;"><p style="line-height: 5px"><%= pid.productID.productName %></p></a>
                    </td>
                    <td style="width: 125px">
                      <p style="color: #dc4e45"><%= VND.format(pid.productID.priceOut) %> </p>
                    </td>
                    <td style="width: 225px; height: 96.75px;">
                      <form action="/update_quantity_cart" method="post">
                          <input name="product_id_hidden" type="hidden" value="<%= pid._id %>"/>
                          <input name="user_id_hidden" type="hidden" value="<%= userid %>"/>
                          <input type="number" min="0" max="<%= pid.productID.productQuantity %>" value="<%= pid.quantity %>" name="quantity" style="width: 45px; height: 30px; padding-left: 10px"/>
                          <input type="submit" value="Cập nhật" name="update_quantity" class="btn btn-primary update-quantity" style="margin-bottom: 5px; margin-left: 5px"/>
                      </form>
                    </td>
                    <td style="width: 125px;">
                      <p style="color: #dc4e45"><%= VND.format(pid.productID.priceOut * parseInt(pid.quantity)) %></p>
                    </td>
                    <td style="width: 200px;">
                      <button type="button" onClick="find(this);" class="btn btn-danger js-buy-tickets"><i class="fa-regular fa-trash-can" style="color: white;"></i> Xóa sản phẩm</button>
                    </td>
                    <div class="modal js-modal">
                      <div class="modal-container js-modal-container">
                          
                          <header class="modal-header">
                              Xóa sản phẩm!
                          </header>
                
                          <div class="modal-body">
                              <label for="tickets-quantity" class="modal-label">
                                  Quý khách có muốn xóa sản phẩm này?
                              </label>
                              <div class="btn-js" style="margin-top:50px; margin-left:200px;">
                                  <a href="/delete_cart_items/www" id="buy-tickets" style="margin-right:15px; background-color: #DC3545;"> Xóa </a>
                                  <a id="buy-tickets" class="modal-close js-modal-close" style="background-color: #6C757D;"> Hủy </a>
                              </div>
                          </div>
                      </div>
                    </div>
                  </tr>
                  <% }); %> <% } %>
                </tbody>
              </table>
            </div>
          <div class="row">
            <div class="col-8"></div>
            <div class="col-4">
                <div class="cart-price">
                  <div style="border: white;">
                    <div style="display: flex;font-weight: 500;">
                      <p>Tạm tính:</p>
                      <p style="color:#DC3545; margin-left: 8px;"><%= VND.format(money) %></p>
                    </div>
            
                    <div class="pay">
                    <a href="/checkout/<%= userid %>">
                        <button class="btn btn-secondary btn-pay">THANH TOÁN</button>
                    </a>
                    </div>
                    <div class="back-home">
                        <a href="/">
                            <button class="btn btn-outline-dark btn-back-home">TIẾP TỤC MUA HÀNG</button>
                        </a>
                    </div>
                </div>
            </div>
          </div>
        <%}%> 
      </div>
    </div>

    <%- include('../partials/footer') %>
  </body>
</html>
