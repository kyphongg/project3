<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Thống kê</title>
    <%- include('partials/head') %>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@^3"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@^1"></script>
</head>
<body>
    <!--sidebar start-->
    <%- include('partials/sidebar') %>
    <!-- sidebar end -->

    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <div class="market-updates">

                <% if(admin_role == 0|| admin_role == 3 ) { %>
                <div class="col-md-3 market-update-gd">
                    <div class="market-update-block clr-block-2">
                        <a href="/customers">
                        <div class="col-md-4 market-update-right">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="col-md-8 market-update-left">
                            <h4>Khách hàng</h4>
                            <h3><%= number %></h3>
                            <p>Số lượt đăng ký tài khoản</p>
                        </div>
                        </a>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <%}%>

                <% if(admin_role == 0|| admin_role == 3 ) { %>
                <div class="col-md-3 market-update-gd">
                    <div class="market-update-block clr-block-1">
                        <a href="#">
                        <div class="col-md-4 market-update-right">
                            <i style="color: white;" class="fa fa-comments fa-3x" aria-hidden="true"></i>
                        </div>
                        <div class="col-md-8 market-update-left">
                            <h4>Bình luận</h4>
                            <h3>22</h3>
                            <p>Số lượng bình luận</p>
                        </div>
                        </a>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <%}%>

                <% if(admin_role == 0) { %>
                <div class="col-md-3 market-update-gd">
                    <div class="market-update-block clr-block-3">
                        <a href="/employees">
                        <div class="col-md-4 market-update-right">
                            <i class="far fa-address-card"></i>
                        </div>
                        <div class="col-md-8 market-update-left">
                                <h4>Nhân viên</h4>
                                <h3><%= numberal %></h3>
                                <p>Số lượng nhân viên</p>
                        </div>
                        </a>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <%}%>

                <% if(admin_role == 0|| admin_role == 2 ) { %>
                <div class="col-md-3 market-update-gd">
                    <div class="market-update-block clr-block-4">
                        <a href="/new_orders">
                        <div class="col-md-4 market-update-right">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <div class="col-md-8 market-update-left">
                                <h4>Đơn mới</h4>
                                <h3><%= order %></h3>
                                <p>Số lượng đơn chưa duyệt</p>
                        </div>
                        </a>
                        <div class="clearfix"></div>
                    </div>
                </div>
                <%}%>

                <% if(admin_role == 0) { %>
                <div class="graphBox">
                  <div class="box">
                    <div class="bestSells-Box">
                      <div class="table-agile-info">
                        <h3 style="text-align: center;">Sản phẩm bán chạy nhất</h3>
                        <div class="table-responsive">
                          <table id="myTable" class="table table-striped table-bordered table-bestSells">
                            <thead>
                              <th>Sản phẩm</th>
                              <th>Hình ảnh</th>
                              <th>Số lượng bán ra</th>
                            </thead>
    
                            <tbody>
                              <% for(let i=0; i < bestSale.length; i++) { %>
                                <% bestSale[i].productList.forEach(function(id) { %>
                              <tr>
                                <td style="text-align: left;"><%= id.productName %></td>
                                <td><img src="/images/<%= id.productImage %>"   width="50" height="80" alt=""></td>
                                <td><%= bestSale[i].totalCount %></td>
                              </tr>
                              <% }); %>
                              <% } %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                    <div class="box">
                        <h3 style="text-align: center;">Doanh thu năm 2023</h3>
                        <input type="hidden" id="value1" value="<%= money1 %>" />
                        <input type="hidden" id="value2" value="<%= money2 %>" />
                        <input type="hidden" id="value3" value="<%= money3 %>" />
                        <input type="hidden" id="value4" value="<%= money4 %>" />
                        <input type="hidden" id="value5" value="<%= money5 %>" />
                        <input type="hidden" id="value6" value="<%= money6 %>" />
                        <input type="hidden" id="value7" value="<%= money7 %>" />
                        <input type="hidden" id="value8" value="<%= money8 %>" />
                        <input type="hidden" id="value9" value="<%= money9 %>" />
                        <input type="hidden" id="value10" value="<%= money10 %>" />
                        <input type="hidden" id="value11" value="<%= money11 %>" />
                        <input type="hidden" id="value12" value="<%= money12 %>" />
                        <canvas id="myChart" style="margin-top: 15px;"></canvas>
                    </div>
                </div>
                <%}%>

                <div class="other-Box">
                  <div class="box">
                    <div class="outOfStock-Box">
                      <div class="table-agile-info">
                        <h3 style="text-align: center;">Sản phẩm sắp hết hàng</h3>
                        <div class="table-responsive">
                          <table id="myTable" class="table table-striped table-bordered table-outOfStock">
                            <thead>
                              <th>STT</th>
                              <th>Tên sản phẩm</th>
                              <th>Hình ảnh</th>
                              <th>Số lượng</th>
                              <th>Trạng thái</th>
                            </thead>
    
                            <tbody>
                              <% for(let i=0; i < outOfStock.length; i++) { %>
                              <tr>
                                <td><%= i+1 %></td>
                                <td><%= outOfStock[i].productName %></td>
                                <td><img src="/images/<%= outOfStock[i].productImage %>"   width="50" height="80" alt=""></td>
                                <td><%= outOfStock[i].productQuantity %></td>
                                <td><p class="btn btn-warning">Sắp hết hàng</p></td>
                              </tr>
                              <% } %>
                            </tbody>
                          </table>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
    </section>
    <!-- Biểu đồ cột -->
    <script>
        let value1 = document.getElementById("value1").value;
        let value2 = document.getElementById("value2").value;
        let value3 = document.getElementById("value3").value;
        let value4 = document.getElementById("value4").value;
        let value5 = document.getElementById("value5").value;
        let value6 = document.getElementById("value6").value;
        let value7 = document.getElementById("value7").value;
        let value8 = document.getElementById("value8").value;
        let value9 = document.getElementById("value9").value;
        let value10 = document.getElementById("value10").value;
        let value11 = document.getElementById("value11").value;
        let value12 = document.getElementById("value12").value;

        var startOfYear = moment().month(0);
        var endOfYear = moment().month(11);
    
        var months = [];
        var month = startOfYear;

        while (month <= endOfYear) {
          months.push(month.format("YYYY-MM"));
          month = month.clone().add(1, "M");
        }
        const data = {
          labels: months,
          datasets: [
            {
              label: ["Doanh thu"],
              data: [value1, value2, value3, value4, value5, value6, value7, value8, value9, value10, value11, value12],
              backgroundColor: ["rgba(255,0,0)","rgba(0,255,0)","rgba(0,0,255)","rgba(255,255,0)","rgba(0,255,255)","rgba(255,0,255)","rgba(192,192,192)","rgba(128,0,0)","rgba(0,128,128)","rgba(0,0,128)","rgba(128,128,0)","rgba(128,0,128)",],
              borderColor: ["rgba(0,0,0)"],
              borderWidth: 1,
            },
          ],
        };
        // config
        const config = {
          type: "bar",
          data,
          options: {
            scales: {
              x: {
                type: "time",
              },
              y: {
                beginAtZero: true,
              },
            },
          },
        };
    
        // render init block
        const myChart = new Chart(document.getElementById("myChart"), config);
        // Instantly assign Chart.js version
        const chartVersion = document.getElementById("chartVersion");
        chartVersion.innerText = Chart.version;
    </script>
    <!--main content end-->
    <%- include('partials/footer') %>
</body>


<!-- Filter date -->

<!-- Biểu đồ -->


</html>

